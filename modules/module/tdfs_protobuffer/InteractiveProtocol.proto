/////////////////////////////////////////////////
//作者：尹宾
//日期：2016-11-25
//内容：初步完成协议框架定义。
//版本：1.0.0
//
//修订：尹宾
//日期：2016-12-22
//修改内容：增加单独的用户查询和设备查询命令
//版本：1.0.1
//
//修订：尹宾
//日期：2017-2-13
//修改内容：完善设备相关命令
//版本：1.0.2
/////////////////////////////////////////////////

///////////////传输协议格式介绍//////////////////
//    __   ____   ____   ______   ____   ______   ______
//   |RG|,|长度|,|源端|,|目标端|,|类型|,|协议体|,|校验和|
//   ￣￣  ￣￣   ￣￣   ￣￣￣   ￣￣   ￣￣￣   ￣￣￣   
//长度：  该值为“源端,目标端,类型,协议体,校验和”的字节数，不包括长度字段后面的逗号。
//源端：  该值为消息传输投递的源头，代表发送消息自身实体，可以唯一表示源端。
//目标端：该值为消息传输投递的目标，代表接收消息实体，一般都需要实现约定好。
//类型：  该值为消息的具体业务类型，目前该值填写0.
//协议体：该值为业务协议的具体内容，就是下面采用protobuffer协议序列化后形成的字节缓冲区，支持Base64编码。
//校验和：该值为“源端,目标端,类型, 协议体”的crc16计算得出的值。
/////////////////////////////////////////////////

///////////////传输协议会话ID解析////////////////
//传输客户端在发起链接时，需要首先与服务器进行一次交互通信，以便获取当前这次链接的会话ID来进行通信，具体解析步骤如下：
//  1：客户端发起链接，按照前述的“传输协议格式”，源端为客户端ID，目标端为0，类型为0，协议体内容如下，来发送消息到服务端。
//     {"ID":"XXX","PWD":"XXX"} 注意：目前该内容服务器段暂未使用，所以客户端可以填写任意值。
//  2：客户端接受响应报文，Decode64处理之后，获得一个json格式字符串，在root节点处解析Key值为UUID的Value，该值就是这次传输
//     链接的会话ID值。
//  3：后续客户端在这次链接中进行消息发送，包装传输协议格式时，“源端”这个值就是会话ID值。
/////////////////////////////////////////////////


//Explicit 'optional' labels are disallowed in the Proto3 syntax. 
//To define 'optional' fields in Proto3, simply remove the 'optional' label, as fields are 'optional' by default.

syntax = "proto3"; 

package Interactive.Message;

enum MsgType
{
  Init_T = 0;
  GetAccessAddressReq_DEV_T = 10000; //设备获取接入服务器地址
  GetAccessAddressRsp_DEV_T = 10010;
  LoginReq_DEV_T = 10020;            //设备登录接入管理服务器
  LoginRsp_DEV_T = 10030; 
  LogoutReq_DEV_T = 10040;           //设备登出接入管理服务器
  LogoutRsp_DEV_T = 10050;  
  ShakehandReq_DEV_T = 10060;        //设备与接入管理服务器握手
  ShakehandRsp_DEV_T = 10070;  
  ConfigInfoReq_DEV_T = 10080;       //设备请求配置信息
  ConfigInfoRsp_DEV_T = 10090;

  
  ////////////////////////////////////////////////////////
  
  MsgPreHandlerReq_USR_T = 19990;    //消息预处理
  MsgPreHandlerRsp_USR_T = 19991;    
  GetAccessAddressReq_USR_T = 20000; //用户获取用户设备管理服务器地址
  GetAccessAddressRsp_USR_T = 20010;
  RegisterUserReq_USR_T = 20020;     //用户注册
  RegisterUserRsp_USR_T = 20030;
  UnRegisterUserReq_USR_T = 20040;   //用户注销
  UnRegisterUserRsp_USR_T = 20050;
  QueryUsrInfoReq_USR_T = 20051;     //用户查询
  QueryUsrInfoRsp_USR_T = 20052;
  LoginReq_USR_T = 20060;            //用户登录用户设备管理服务器
  LoginRsp_USR_T = 20070; 
  LogoutReq_USR_T = 20080;           //用户登出用户设备管理服务器
  LogoutRsp_USR_T = 20090;  
  ShakehandReq_USR_T = 20100;        //用户与用户设备管理服务器握手
  ShakehandRsp_USR_T = 20110;  
  ConfigInfoReq_USR_T = 20120;       //用户请求配置信息
  ConfigInfoRsp_USR_T = 20130;
  
  AddDevReq_USR_T = 20140;           //用户添加设备
  AddDevRsp_USR_T = 20150;
  DelDevReq_USR_T = 20160;           //用户删除设备
  DelDevRsp_USR_T = 20170;
  ModifyDevReq_USR_T = 20180;        //用户修改设备
  ModifyDevRsp_USR_T = 20190;
  QueryDevInfoReq_USR_T = 20191;     //用户查询设备
  QueryDevInfoRsp_USR_T = 20192;
  QueryDevReq_USR_T = 20200;         //用户查询设备关系
  QueryDevRsp_USR_T = 20210;  
  QueryUserReq_USR_T = 20211;        //设备相关用户
  QueryUserRsp_USR_T = 20212;
  SharingDevReq_USR_T = 20220;       //用户共享设备
  SharingDevRsp_USR_T = 20230;
  CancelSharedDevReq_USR_T = 20240;  //用户取消共享设备
  CancelSharedDevRsp_USR_T = 20250;
  
  AddFriendsReq_USR_T = 20260;       //用户添加好友
  AddFriendsRsp_USR_T = 20270;
  DelFriendsReq_USR_T = 20280;       //用户删除好友
  DelFriendsRsp_USR_T = 20290;
  ModifyFriendsReq_USR_T = 20300;    //用户修改好友，目前暂不实现
  ModifyFriendsRsp_USR_T = 20310;
  QueryFriendsReq_USR_T = 20320;     //用户查询好友
  QueryFriendsRsp_USR_T = 20330;
   
  ///////////////////////////////////////////////////////
  
  GetOnlineDevInfoReq_INNER_T = 30000;          //获取在线设备信息
  GetOnlineDevInfoRsp_INNER_T = 30010;
  BroadcastOnlineDevInfo_INNER_T = 30020;       //广播在线设备信息
  GetOnlineUserInfoReq_INNER_T = 30030;         //获取在线用户信息
  GetOnlineUserInfoRsp_INNER_T = 30040;
  BroadcastOnlineUserInfo_INNER_T = 30050;      //广播在线用户信息
  
}

message PermissionOfUser                        //用户权限对象
{
  uint32 uiUnlimited = 1;
  uint32 uiWatch = 2;    
}

message Device                                  //设备信息对象
{
  string strDevID = 1;
  string strDevName = 2;
  string strDevPassword = 3;
  uint32 uiTypeInfo = 4;
  string strCreatedate = 5;
  uint32 uiStatus = 6;
  string strExtend = 7;
  string strInnerinfo = 8;                      //设备上传到平台的信息
  
}

message User                                    //用户信息对象
{
  string strUserID = 1;
  string strUserName = 2;
  string strUserPassword = 3;
  uint32 uiTypeInfo = 4;
  string strCreatedate = 5;
  uint32 uiStatus = 6;
  string strExtend = 7;
  
}

message Relation                                //用户与设备关系（设备与用户关系）
{
  string strUserID = 1;
  string strDevID = 2;
  uint32 uiRelation = 3;                        //关系包括，拥有0、被分享1、分享中2、转移3
  string strBeginDate = 4;
  string strEndDate = 5;
  string strValue = 6;
}

//////////////////////////////////////////////////////////////////////////////////////

message GetAccessAddressReq_DEV                 //分布式场景下用
{
  string strDevID = 1;
  string strValue = 2;
}

message GetAccessAddressRsp_DEV                 //分布式场景下用
{
  string strAccessAddress = 1;
  string strAccessPort = 2;
  string strValue = 3;
}

message LoginReq_DEV                            //设备登陆请求
{
  string strDevID = 1;
  string strPassword = 2;
  string strValue = 3;
}

message LoginRsp_DEV                            //设备登陆响应
{
  string strConfigInfo = 1;                     //设备配置信息
  string strValue = 2;
}

message LogoutReq_DEV                           //设备登出请求
{
  string strDevID = 1;
  string strValue = 2;
}

message LogoutRsp_DEV                           //设备登出响应
{
  string strValue = 1;
}

message ShakehandReq_DEV                        //设备握手请求
{
  string strDevID = 1;
  string strDevCurrentStatusInfo = 2;           //设备当前状态信息
  string strValue = 3;
}

message ShakehandRsp_DEV                        //设备握手响应
{
  string strValue = 1;
}

message ConfigInfoReq_DEV                       //设备配置信息请求
{
  string strDevID = 1;
  string strValue = 2;
}

message ConfigInfoRsp_DEV                       //设备配置信息响应
{
  string strConfigInfo = 1;                     //设备配置信息
  string strValue = 2;
}



////////////////////////////////////////////////////////

message MsgPreHandlerReq_USR                    //消息预处理，包括了一些通用的检查动作
{
  string strValue = 1;
}

message MsgPreHandlerRsp_USR                    //消息预处理响应，若是失败，则后续业务操作都全部终止
{
  string strValue = 1;
}

message GetAccessAddressReq_USR                 //分布式场景下用
{
  string strSerializeID = 1;                    
  string strValue = 2;
}

message GetAccessAddressRsp_USR                 //分布式场景下用
{
  string strAccessAddress = 1;
  string strAccessPort = 2;
  string strValue = 3;
}

message RegisterUserReq_USR                     //用户注册请求
{
  User userInfo = 1;
  string strValue = 2;
}

message RegisterUserRsp_USR                     //用户注册响应
{
  string strUserID = 1;                         //系统返回用户ID，这个ID后续用来代表用户的身份来进行后续的操作
  string strValue = 2;
}

message UnRegisterUserReq_USR                   //用户注销请求
{
  User userInfo = 1;
  string strValue = 2;
}

message UnRegisterUserRsp_USR                   //用户注销响应
{
  string strUserID = 1;
  string strValue = 2;  
}

message QueryUsrInfoReq_USR                     //查询用户信息请求
{
  string strUserID = 1;
  string strValue = 2;
}

message QueryUsrInfoRsp_USR                     //查询用户信息响应
{
  User userInfo = 1;
  string strValue = 2;
}

message LoginReq_USR                            //用户登录请求
{
  User userInfo = 1;
  string strValue = 2;
}

message LoginRsp_USR                            //用户登录响应
{
  string strUserID = 1;                         //系统返回用户ID，这个ID后续用来代表用户的身份来进行后续的操作
  repeated Relation relationInfo = 2;           //这里直接返回用户与设备关联的信息，便于前端处理
  string strValue = 3;
}

message LogoutReq_USR                           //用户登出请求
{
  User userInfo = 1;
  string strValue = 2;
}

message LogoutRsp_USR                           //用户登出响应
{
  string strValue = 1;
}

message ShakehandReq_USR                        //用户与平台的握手请求，这里握手主要是用来对后台对应的Session进行保活处理
{
  string strUserID = 1;
  string strValue = 2;
}

message ShakehandRsp_USR                        //用户与平台的握手响应
{
  string strValue = 1;
}

message ConfigInfoReq_USR                       //用户配置信息请求
{
  string strUserID = 1;
  string strValue = 2;
}

message ConfigInfoRsp_USR                       //用户配置信息响应
{
  string strValue = 1;
  repeated string strItems = 2;
}


message AddDevReq_USR                           //添加设备请求，同时建立了用户与设备之间绑定关系
{
  string strUserID = 1;
  Device devInfo = 2;
  
}

message AddDevRsp_USR                           //添加设备响应。
{
  string strValue = 1;
}

message DelDevReq_USR                           //删除设备请求
{
  string strUserID = 1;
  repeated string strDevID = 2;                 //支持批量设备删除，这里增加、修改、查询都不支持单个命令批量处理，只有删除支持批量处理
}

message DelDevRsp_USR                           //删除设备响应
{
  string strValue = 1;
  repeated string strDevIDFailed = 2;           //考虑到批量删除设备，部分失败的情况。
}

message ModifyDevReq_USR                        //修改设备信息请求
{
  string strUserID = 1;
  Device devInfo = 2;
}

message ModifyDevRsp_USR                        //修改设备信息响应
{
  string strValue = 1;
}

message QueryDevInfoReq_USR                     //查询设备信息请求
{
  string strDevID = 1;
  string strValue = 2;
}

message QueryDevInfoRsp_USR                     //查询设备信息响应
{
  Device devInfo = 1;
  string strValue = 2;
}

message QueryDevReq_USR                         //查询用户关联设备的信息，这里要考虑到分页处理
{
  string strUserID = 1;
  uint32 uiBeginIndex = 2;
  string strValue = 3;
}

message QueryDevRsp_USR                         //查询用户关联设备响应，这里返回的是Relation对象，描述了用户与设备之间的关系。
{
  repeated Relation allRelationInfo = 1;      
}

message QueryUserReq_USR                        //查询设备关联的用户信息，这里要考虑分页处理
{
  string strDevID = 1;
  uint32 uiBeginIndex = 2;
  string strValue = 3;
}

message QueryUserRsp_USR                        //查询设备关联用户信息响应
{
  repeated Relation allRelationInfo = 1;
}

message SharingDevReq_USR                       //分享设备请求
{
  Relation relationInfo = 1;
  string strValue = 2;
}

message SharingDevRsp_USR                       //分享设备响应
{
  string strValue = 1;
}

message CancelSharedDevReq_USR                  //取消分享设备请求
{
  Relation relationInfo = 1;
  string strValue = 2;
}

message CancelSharedDevRsp_USR                  //取消分享设备响应
{
  string strValue = 1;  
}

message AddFriendsReq_USR                       //添加好友请求。好友关系只有增加、删除、查询，没有修改动作
{
  string strUserID = 1;
  string strFriendUserID = 2;
}

message AddFriendsRsp_USR                       //添加好友响应
{
  string strValue = 1;  
}

message DelFriendsReq_USR                       //删除好友请求，支持批量删除好友
{
  string strUserID = 1;
  repeated string strFriendUserID = 2;
}

message DelFriendsRsp_USR                       //删除好友响应
{
  string strValue = 1;
  repeated string strFriendUserIDFailed = 2;    //考虑到批量删除好友，部分失败的情况。
}

message QueryFriendsReq_USR                     //查询好友请求
{
  string strUserID = 1;
  uint32 uiBeginIndex = 2;
  string strValue = 3;
}

message QueryFriendsRsp_USR                     //查询好友响应
{
  repeated string strAllFriendUserID = 1;
}


////////////////////////////////////////////////下面这些都是一些通知、广播类的消息///////////////////

message GetOnlineDevInfoReq_INNER               
{
  string strValue = 1;
}

message GetOnlineDevInfoRsp_INNER
{
  repeated Device devInfo = 1;
  string strValue = 2;
}

message BroadcastOnlineDevInfo_INNER
{
  repeated Device devInfo = 1;
  string strValue = 2;
}

message GetOnlineUserInfoReq_INNER
{
  string strValue = 1;
}

message GetOnlineUserInfoRsp_INNER
{
  repeated User userInfo = 1;
  string strValue = 2;
}

message BroadcastOnlineUserInfo_INNER
{  
  repeated User userInfo = 1;
  string strValue = 2;
}



/////////////////////////////////////////////////////////////////////////////////////////////////////////////

//请求对象
message Req
{
  GetAccessAddressReq_DEV GetAccessAddressReq_DEV_Value = 10;      //设备获取接入服务器地址 
  LoginReq_DEV LoginReq_DEV_Value = 20;                            //设备登录接入管理服务器
  LogoutReq_DEV LogoutReq_DEV_Value = 30;                          //设备登出接入管理服务器
  ShakehandReq_DEV ShakehandReq_DEV_Value = 40;                    //设备与接入管理服务器握手
  ConfigInfoReq_DEV ConfigInfoReq_DEV_Value = 50;                  //设备请求配置信息

  
  MsgPreHandlerReq_USR MsgPreHandlerReq_USR_Value = 65;            //消息预处理
  GetAccessAddressReq_USR GetAccessAddressReq_USR_Value = 70;      //用户获取用户设备管理服务器地址
  RegisterUserReq_USR RegisterUserReq_USR_Value = 80;              //用户注册
  UnRegisterUserReq_USR UnRegisterUserReq_USR_Value = 90;          //用户注销
  QueryUsrInfoReq_USR QueryUsrInfoReq_USR_Value = 100;             //用户查询
  LoginReq_USR LoginReq_USR_Value = 110;                           //用户登录用户设备管理服务器
  LogoutReq_USR LogoutReq_USR_Value = 120;                         //用户登出用户设备管理服务器
  ShakehandReq_USR ShakehandReq_USR_Value = 130;                   //用户与用户设备管理服务器握手
  ConfigInfoReq_USR ConfigInfoReq_USR_Value = 140;                 //用户请求配置信息
  
  AddDevReq_USR AddDevReq_USR_Value = 150;                         //用户添加设备
  DelDevReq_USR DelDevReq_USR_Value = 160;                         //用户删除设备
  ModifyDevReq_USR ModifyDevReq_USR_Value = 170;                   //用户修改设备
  QueryDevInfoReq_USR QueryDevInfoReq_USR_Value = 180;             //用户查询设备
  QueryDevReq_USR QueryDevReq_USR_Value = 190;                     //用户根据用户ID查看相关联的设备
  QueryUserReq_USR QueryUserReq_USR_Value = 200;                   //用户根据设备ID查看相关联的用户
  SharingDevReq_USR SharingDevReq_USR_Value = 210;                 //用户共享设备
  CancelSharedDevReq_USR CancelSharedDevReq_USR_Value = 220;       //用户取消共享设备
  
  AddFriendsReq_USR AddFriendsReq_USR_Value = 230;                 //用户添加好友
  DelFriendsReq_USR DelFriendsReq_USR_Value = 240;                 //用户删除好友
  QueryFriendsReq_USR QueryFriendsReq_USR_Value = 250;             //用户查询好友
  
  GetOnlineDevInfoReq_INNER GetOnlineDevInfoReq_INNER_Value = 260;                //获取在线设备信息
  BroadcastOnlineDevInfo_INNER BroadcastOnlineDevInfo_INNER_Value = 270;        //广播在线设备信息
  GetOnlineUserInfoReq_INNER GetOnlineUserInfoReq_INNER_Value = 280;              //获取在线用户信息
  BroadcastOnlineUserInfo_INNER BroadcastOnlineUserInfo_INNER_Value = 290;      //广播在线用户信息
  
}

//响应对象
message Rsp
{
  int32 iRetcode = 10;                                             //返回码
  string strRetMsg = 20;                                           //返回消息
  
  
  GetAccessAddressRsp_DEV GetAccessAddressRsp_DEV_Value = 30;      //设备获取接入服务器地址 
  LoginRsp_DEV LoginRsp_DEV_Value = 40;                            //设备登录接入管理服务器
  LogoutRsp_DEV LogoutRsp_DEV_Value = 50;                          //设备登出接入管理服务器
  ShakehandRsp_DEV ShakehandRsp_DEV_Value = 60;                    //设备与接入管理服务器握手
  ConfigInfoRsp_DEV ConfigInfoRsp_DEV_Value = 70;                  //设备请求配置信息
  
  
  MsgPreHandlerRsp_USR MsgPreHandlerRsp_USR_Value = 85;            //消息预处理
  GetAccessAddressRsp_USR GetAccessAddressRsp_USR_Value = 90;      //用户获取用户设备管理服务器地址
  RegisterUserRsp_USR RegisterUserRsp_USR_Value = 100;             //用户注册
  UnRegisterUserRsp_USR UnRegisterUserRsp_USR_Value = 110;         //用户注销
  QueryUsrInfoRsp_USR QueryUsrInfoRsp_USR_Value = 120;             //用户查询
  LoginRsp_USR LoginRsp_USR_Value = 130;                           //用户登录用户设备管理服务器
  LogoutRsp_USR LogoutRsp_USR_Value = 140;                         //用户登出用户设备管理服务器
  ShakehandRsp_USR ShakehandRsp_USR_Value = 150;                   //用户与用户设备管理服务器握手
  ConfigInfoRsp_USR ConfigInfoRsp_USR_Value = 160;                 //用户请求配置信息
  
  AddDevRsp_USR AddDevRsp_USR_Value = 170;                         //用户添加设备
  DelDevRsp_USR DelDevRsp_USR_Value = 180;                         //用户删除设备
  ModifyDevRsp_USR ModifyDevRsp_USR_Value = 190;                   //用户修改设备
  QueryDevInfoRsp_USR QueryDevInfoRsp_USR_Value = 200;             //用户查询设备
  QueryDevRsp_USR QueryDevRsp_USR_Value = 210;                     //用户根据用户ID查看相关联的设备
  QueryUserRsp_USR QueryUserRsp_USR_Value = 220;                   //用户根据设备ID查看相关联的用户
  SharingDevRsp_USR SharingDevRsp_USR_Value = 230;                 //用户共享设备
  CancelSharedDevRsp_USR CancelSharedDevRsp_USR_Value = 240;       //用户取消共享设备
  
  AddFriendsRsp_USR AddFriendsRsp_USR_Value = 250;                 //用户添加好友
  DelFriendsRsp_USR DelFriendsRsp_USR_Value = 260;                 //用户删除好友
  QueryFriendsRsp_USR QueryFriendsRsp_USR_Value = 270;             //用户查询好友
  
  GetOnlineDevInfoRsp_INNER GetOnlineDevInfoRsp_INNER_Value = 280; //获取在线设备信息
  GetOnlineUserInfoRsp_INNER GetOnlineUserInfoRsp_INNER_Value = 290; //获取在线用户信息

}

//主消息对象，包括了请求、响应，根据消息类型的不同来进行对应的处理
message InteractiveMessage
{
  MsgType type = 1;        //消息类型
  uint64 uiMsgSeq = 2;     //消息序号
  string strSID = 3;       //会话ID
  Req ReqValue = 4;        //请求值
  Rsp RspValue = 5;        //响应值
}

